<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard | CropGenius</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 text-gray-800">

<!-- Navbar -->
<nav class="bg-green-600 text-white p-4 flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-2 sm:space-y-0 shadow-lg">
  <h1 class="text-2xl font-bold">ğŸŒ± CropGenius</h1>

  <div class="flex flex-wrap items-center gap-2 sm:gap-4">
    <a href="/" class="hover:underline">Home</a>
    <a href="/dashboard" class="hover:underline font-semibold bg-green-700 px-3 py-1 rounded">Dashboard</a>
    <a href="/my-predictions" class="hover:underline">My Predictions</a>
    <a href="/compare-crops" class="hover:underline">Compare Crops</a>
    <a href="/yield_cost" class="hover:underline">Yield & Cost</a>
    <a href="/smart_bima" class="hover:underline">Smart Bima</a>

    {% if session.get('username') %}
      <span class="ml-2 font-semibold">ğŸ‘‹ {{ session['username'] }}</span>
      <a href="/logout" class="bg-red-500 px-3 py-1 rounded hover:bg-red-600 text-sm">Logout</a>
    {% endif %}

    <div id="google_translate_element" class="ml-2"></div>
  </div>
</nav>

<!-- Header Section -->
<section class="bg-gradient-to-r from-green-600 via-green-700 to-blue-600 text-white py-12 px-4 text-center shadow-xl">
  <h2 class="text-4xl sm:text-5xl font-bold mb-3">ğŸ“Š Your Farming Dashboard</h2>
  <p class="text-green-100 text-lg">Welcome back, <span class="font-bold">{{ session['username'] }}</span>! Here's your farming overview</p>
</section>

<!-- Dashboard Content -->
<section class="max-w-7xl mx-auto mt-8 mb-12 px-4">
  
  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Total Predictions -->
    <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-2xl p-6 shadow-xl hover:shadow-2xl transition transform hover:-translate-y-1">
      <div class="flex items-center justify-between mb-3">
        <div class="bg-white bg-opacity-20 p-3 rounded-lg">
          <span class="text-3xl">ğŸ“ˆ</span>
        </div>
        <div class="text-right">
          <p class="text-4xl font-bold">{{ total_predictions }}</p>
          <p class="text-blue-100 text-sm">Total Predictions</p>
        </div>
      </div>
      <div class="border-t border-blue-400 pt-3">
        <p class="text-xs text-blue-100">Your farming insights</p>
      </div>
    </div>

    <!-- Most Recommended Crop -->
    <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-2xl p-6 shadow-xl hover:shadow-2xl transition transform hover:-translate-y-1">
      <div class="flex items-center justify-between mb-3">
        <div class="bg-white bg-opacity-20 p-3 rounded-lg">
          <span class="text-3xl">ğŸŒ¾</span>
        </div>
        <div class="text-right">
          <p class="text-2xl font-bold">{{ top_crop or 'N/A' }}</p>
          <p class="text-green-100 text-sm">Top Recommended</p>
        </div>
      </div>
      <div class="border-t border-green-400 pt-3">
        <p class="text-xs text-green-100">Most suggested crop</p>
      </div>
    </div>

    <!-- Unique Crops Explored -->
    <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-2xl p-6 shadow-xl hover:shadow-2xl transition transform hover:-translate-y-1">
      <div class="flex items-center justify-between mb-3">
        <div class="bg-white bg-opacity-20 p-3 rounded-lg">
          <span class="text-3xl">ğŸŒ¿</span>
        </div>
        <div class="text-right">
          <p class="text-4xl font-bold">{{ unique_crops }}</p>
          <p class="text-purple-100 text-sm">Unique Crops</p>
        </div>
      </div>
      <div class="border-t border-purple-400 pt-3">
        <p class="text-xs text-purple-100">Different crop types</p>
      </div>
    </div>

    <!-- Last Activity -->
    <div class="bg-gradient-to-br from-orange-500 to-orange-600 text-white rounded-2xl p-6 shadow-xl hover:shadow-2xl transition transform hover:-translate-y-1">
      <div class="flex items-center justify-between mb-3">
        <div class="bg-white bg-opacity-20 p-3 rounded-lg">
          <span class="text-3xl">â°</span>
        </div>
        <div class="text-right">
          <p class="text-lg font-bold">{{ last_activity or 'Never' }}</p>
          <p class="text-orange-100 text-sm">Last Prediction</p>
        </div>
      </div>
      <div class="border-t border-orange-400 pt-3">
        <p class="text-xs text-orange-100">Most recent activity</p>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="bg-white rounded-3xl shadow-xl p-8 mb-8">
    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
      <span class="text-3xl">âš¡</span> Quick Actions
    </h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <a href="/" class="bg-gradient-to-br from-green-100 to-green-200 hover:from-green-200 hover:to-green-300 p-6 rounded-xl shadow-md hover:shadow-lg transition text-center group">
        <div class="text-5xl mb-3 group-hover:scale-110 transition">ğŸŒ¾</div>
        <p class="font-bold text-gray-800">New Prediction</p>
        <p class="text-xs text-gray-600 mt-1">Get crop recommendation</p>
      </a>

      <a href="/my-predictions" class="bg-gradient-to-br from-blue-100 to-blue-200 hover:from-blue-200 hover:to-blue-300 p-6 rounded-xl shadow-md hover:shadow-lg transition text-center group">
        <div class="text-5xl mb-3 group-hover:scale-110 transition">ğŸ“Š</div>
        <p class="font-bold text-gray-800">View History</p>
        <p class="text-xs text-gray-600 mt-1">All your predictions</p>
      </a>

      <a href="/compare-crops" class="bg-gradient-to-br from-purple-100 to-purple-200 hover:from-purple-200 hover:to-purple-300 p-6 rounded-xl shadow-md hover:shadow-lg transition text-center group">
        <div class="text-5xl mb-3 group-hover:scale-110 transition">âš–ï¸</div>
        <p class="font-bold text-gray-800">Compare Crops</p>
        <p class="text-xs text-gray-600 mt-1">Side-by-side analysis</p>
      </a>

      <a href="/yield_cost" class="bg-gradient-to-br from-yellow-100 to-yellow-200 hover:from-yellow-200 hover:to-yellow-300 p-6 rounded-xl shadow-md hover:shadow-lg transition text-center group">
        <div class="text-5xl mb-3 group-hover:scale-110 transition">ğŸ’°</div>
        <p class="font-bold text-gray-800">Yield & Cost</p>
        <p class="text-xs text-gray-600 mt-1">Estimate profits</p>
      </a>
    </div>
  </div>

  <!-- Two Column Layout -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    
    <!-- Recent Predictions -->
    <div class="lg:col-span-2 bg-white rounded-3xl shadow-xl p-8">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
          <span class="text-3xl">ğŸ“œ</span> Recent Predictions
        </h3>
        <a href="/my-predictions" class="text-green-600 hover:text-green-700 font-semibold text-sm">View All â†’</a>
      </div>

      {% if recent_predictions %}
      <div class="space-y-4">
        {% for pred in recent_predictions[:5] %}
        <div class="bg-gradient-to-r from-gray-50 to-green-50 border-l-4 border-green-500 p-4 rounded-lg hover:shadow-md transition">
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <div class="flex items-center gap-3 mb-2">
                <span class="text-2xl">ğŸŒ¾</span>
                <h4 class="text-xl font-bold text-green-700">{{ pred[8] }}</h4>
              </div>
              <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-sm text-gray-600">
                <div class="flex items-center gap-1">
                  <span class="font-semibold">N:</span> {{ pred[1] }}
                </div>
                <div class="flex items-center gap-1">
                  <span class="font-semibold">P:</span> {{ pred[2] }}
                </div>
                <div class="flex items-center gap-1">
                  <span class="font-semibold">K:</span> {{ pred[3] }}
                </div>
                <div class="flex items-center gap-1">
                  <span class="font-semibold">pH:</span> {{ pred[6] }}
                </div>
              </div>
              {% if pred[9] %}
              <p class="text-xs text-gray-500 mt-2">ğŸ“ {{ pred[9] }}</p>
              {% endif %}
            </div>
            <div class="text-right ml-4">
              <p class="text-xs text-gray-500">{{ pred[10][:10] }}</p>
              <a href="/yield_cost?crop={{ pred[8] }}" class="text-green-600 hover:text-green-700 text-xs font-semibold mt-1 inline-block">
                View Details â†’
              </a>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="text-center py-12">
        <div class="text-6xl mb-4">ğŸŒ±</div>
        <p class="text-gray-600 mb-4">No predictions yet</p>
        <a href="/" class="inline-block bg-green-600 text-white px-6 py-3 rounded-full font-semibold hover:bg-green-700 transition">
          Make Your First Prediction
        </a>
      </div>
      {% endif %}
    </div>

    <!-- Crop Distribution & Tips -->
    <div class="space-y-6">
      
      <!-- Crop Distribution Chart -->
      <div class="bg-white rounded-3xl shadow-xl p-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
          <span class="text-2xl">ğŸ“Š</span> Crop Distribution
        </h3>
        {% if crop_distribution %}
        <div class="relative h-64">
          <canvas id="cropChart"></canvas>
        </div>
        <div class="mt-4 space-y-2">
          {% for crop, count in crop_distribution[:5] %}
          <div class="flex items-center justify-between text-sm">
            <span class="font-semibold text-gray-700">{{ crop }}</span>
            <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full font-bold">{{ count }}</span>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-8">
          <p class="text-gray-500">No data available</p>
        </div>
        {% endif %}
      </div>

      <!-- Farming Tips -->
      <div class="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-3xl shadow-xl p-6">
        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
          <span class="text-2xl">ğŸ’¡</span> Farming Tips
        </h3>
        <ul class="space-y-3 text-sm">
          <li class="flex items-start gap-2">
            <span class="text-xl">ğŸŒ±</span>
            <p>Test your soil regularly for accurate NPK values</p>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-xl">ğŸ’§</span>
            <p>Monitor rainfall patterns for better crop planning</p>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-xl">ğŸŒ¡ï¸</span>
            <p>Consider seasonal temperature variations</p>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-xl">ğŸ“Š</span>
            <p>Compare multiple crops before final decision</p>
          </li>
          <li class="flex items-start gap-2">
            <span class="text-xl">ğŸ’°</span>
            <p>Calculate yield and costs for profit planning</p>
          </li>
        </ul>
      </div>

    </div>
  </div>

</section>

<!-- Footer -->
<footer class="bg-green-600 text-white text-center p-4 mt-10 text-sm sm:text-base">
  <p>Â© 2025 CropGenius | Designed for Smart Farming</p>
</footer>

<!-- Chart.js Script -->
<script>
  {% if crop_distribution %}
  const ctx = document.getElementById('cropChart');
  new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: {{ crop_labels | tojson }},
      datasets: [{
        data: {{ crop_counts | tojson }},
        backgroundColor: [
          '#10b981',
          '#3b82f6',
          '#8b5cf6',
          '#f59e0b',
          '#ef4444',
          '#06b6d4',
          '#ec4899'
        ],
        borderWidth: 3,
        borderColor: '#ffffff'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return context.label + ': ' + context.parsed + ' predictions';
            }
          }
        }
      }
    }
  });
  {% endif %}
</script>

<!-- Google Translate Script -->
<script type="text/javascript">
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'en,mr,hi,ta,te,kn,gu,bn,pa',
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google_translate_element');
  }
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

</body>
</html>
