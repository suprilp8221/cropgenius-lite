<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crop Genius - Crop Prediction</title>

  <!-- Tailwind CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-green-50 text-gray-800">

<!-- Navbar -->
<nav class="bg-green-600 text-white p-4 flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-2 sm:space-y-0">
  <h1 class="text-2xl font-bold">ğŸŒ± CropGenius</h1>

  <div class="flex flex-wrap items-center gap-2 sm:gap-4">
    <a href="/" class="hover:underline">Home</a>
    <a href="/predict" class="hover:underline">Prediction</a>
    <a href="/yield_cost" class="hover:underline">Yield & Cost</a>
    <a href="/crop_info" class="hover:underline">Crop Info</a>

    {% if session.get('username') %}
      <span class="ml-2 font-semibold">ğŸ‘‹ {{ session['username'] }}</span>
      <a href="/logout" class="bg-red-500 px-3 py-1 rounded hover:bg-red-600 text-sm">Logout</a>
    {% else %}
      <a href="/login" class="bg-blue-500 px-3 py-1 rounded hover:bg-blue-600 text-sm">Login</a>
    {% endif %}

    <div id="google_translate_element" class="ml-2"></div>
  </div>
</nav>

<!-- Hero Section -->
<section class="text-center py-16 px-4 sm:px-6 bg-gradient-to-r from-green-500 to-green-700 text-white shadow-lg">
  <h2 class="text-4xl sm:text-5xl font-bold mb-4 drop-shadow-lg">ğŸŒ¾ Welcome to CropGenius</h2>
  <p class="text-lg sm:text-xl mb-3 max-w-3xl mx-auto">Input your farm's conditions to get AI-powered crop recommendations</p>
  <p class="text-green-100 font-semibold text-base sm:text-lg">ğŸ”¬ Smart predictions based on soil nutrients, weather, and rainfall data</p>
</section>

<!-- Form Section -->
<section class="max-w-5xl mx-auto mt-10 mb-12 px-4">
  <div class="bg-white p-8 sm:p-12 rounded-3xl shadow-2xl border-t-4 border-green-500">
    <h3 class="text-3xl sm:text-4xl font-bold mb-8 text-center bg-gradient-to-r from-green-600 to-green-800 bg-clip-text text-transparent">
      ğŸŒ¿ Crop Prediction Form
    </h3>

  <!-- Weather Auto-Fill Section -->
  <div class="mb-8 p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl border-2 border-blue-300 shadow-md">
    <h4 class="text-xl font-bold mb-4 text-blue-800 flex items-center gap-2">
      <span class="text-2xl">ğŸ“</span> Auto-Fill Weather Data
    </h4>
    <div class="flex flex-col sm:flex-row gap-3">
      <div class="flex-1">
        <label for="location" class="block text-sm font-semibold mb-2 text-gray-700">Enter Your Location (City Name)</label>
        <input type="text" id="location" placeholder="e.g., Mumbai, Delhi, Pune, Bangalore"
          class="w-full p-4 border-2 border-blue-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-sm hover:shadow-md">
      </div>
      <div class="sm:self-end">
        <button type="button" onclick="fetchWeather()" 
          class="w-full sm:w-auto bg-gradient-to-r from-blue-600 to-blue-700 text-white px-8 py-4 rounded-xl font-bold hover:from-blue-700 hover:to-blue-800 transition duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
          <span class="text-xl">ğŸŒ¤ï¸</span> Get Weather
        </button>
      </div>
    </div>
    <p id="weather-status" class="mt-3 text-sm font-medium"></p>
  </div>

  <form action="/predict" method="POST">
    <!-- Soil Nutrients Section -->
    <div class="mb-8">
      <h4 class="text-xl font-bold mb-4 text-gray-800 flex items-center gap-2 pb-2 border-b-2 border-green-200">
        <span class="text-2xl">ğŸ§ª</span> Soil Nutrients (NPK)
      </h4>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
        <div class="group">
          <label for="N" class="block text-sm font-semibold mb-2 text-gray-700 flex items-center gap-1">
            <span class="text-lg">ğŸŒ±</span> Nitrogen (N)
          </label>
          <input type="number" name="N" id="N" required placeholder="0 - 200"
            class="w-full p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all shadow-sm hover:shadow-md group-hover:border-green-300">
          <p class="text-xs text-gray-500 mt-1">kg/ha</p>
        </div>

        <div class="group">
          <label for="P" class="block text-sm font-semibold mb-2 text-gray-700 flex items-center gap-1">
            <span class="text-lg">âš—ï¸</span> Phosphorus (P)
          </label>
          <input type="number" name="P" id="P" required placeholder="0 - 150"
            class="w-full p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all shadow-sm hover:shadow-md group-hover:border-green-300">
          <p class="text-xs text-gray-500 mt-1">kg/ha</p>
        </div>

        <div class="group">
          <label for="K" class="block text-sm font-semibold mb-2 text-gray-700 flex items-center gap-1">
            <span class="text-lg">ğŸŒ¾</span> Potassium (K)
          </label>
          <input type="number" name="K" id="K" required placeholder="0 - 200"
            class="w-full p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all shadow-sm hover:shadow-md group-hover:border-green-300">
          <p class="text-xs text-gray-500 mt-1">kg/ha</p>
        </div>
      </div>
    </div>

    <!-- Weather & Climate Section -->
    <div class="mb-8">
      <h4 class="text-xl font-bold mb-4 text-gray-800 flex items-center gap-2 pb-2 border-b-2 border-blue-200">
        <span class="text-2xl">ğŸŒ¤ï¸</span> Weather & Climate Data
      </h4>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div class="group">
          <label for="temperature" class="block text-sm font-semibold mb-2 text-gray-700 flex items-center gap-1">
            <span class="text-lg">ğŸŒ¡ï¸</span> Temperature
          </label>
          <input type="number" step="0.1" name="temperature" id="temperature" required placeholder="10 - 50"
            class="w-full p-4 border-2 border-yellow-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-sm hover:shadow-md bg-yellow-50">
          <p class="text-xs text-blue-600 mt-1 font-medium">âœ¨ Auto-filled from weather</p>
        </div>

        <div class="group">
          <label for="humidity" class="block text-sm font-semibold mb-2 text-gray-700 flex items-center gap-1">
            <span class="text-lg">ğŸ’§</span> Humidity
          </label>
          <input type="number" step="0.1" name="humidity" id="humidity" required placeholder="10 - 100"
            class="w-full p-4 border-2 border-yellow-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-sm hover:shadow-md bg-yellow-50">
          <p class="text-xs text-blue-600 mt-1 font-medium">âœ¨ Auto-filled from weather</p>
        </div>

        <div class="group">
          <label for="rainfall" class="block text-sm font-semibold mb-2 text-gray-700 flex items-center gap-1">
            <span class="text-lg">ğŸŒ§ï¸</span> Rainfall
          </label>
          <input type="number" step="0.1" name="rainfall" id="rainfall" required placeholder="0 - 1000"
            class="w-full p-4 border-2 border-yellow-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-sm hover:shadow-md bg-yellow-50">
          <p class="text-xs text-blue-600 mt-1 font-medium">âœ¨ Auto-filled from weather</p>
        </div>

        <div class="group">
          <label for="pH" class="block text-sm font-semibold mb-2 text-gray-700 flex items-center gap-1">
            <span class="text-lg">ğŸ§«</span> Soil pH
          </label>
          <input type="number" step="0.1" name="pH" id="pH" required placeholder="3.5 - 9.0"
            class="w-full p-4 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all shadow-sm hover:shadow-md group-hover:border-green-300">
          <p class="text-xs text-gray-500 mt-1">Acidity/Alkalinity level</p>
        </div>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="text-center mt-10">
      <button type="submit"
        class="bg-gradient-to-r from-green-600 to-green-700 text-white px-12 py-5 rounded-full font-bold text-xl hover:from-green-700 hover:to-green-800 transition duration-300 shadow-xl hover:shadow-2xl transform hover:scale-105">
        <span class="text-2xl mr-2">ğŸ”</span> Predict Best Crop
      </button>
      <p class="text-sm text-gray-500 mt-3">Get AI-powered crop recommendations instantly</p>
    </div>
  </form>

  <!-- Disease Detection Button -->
  <div class="text-center mt-8 pt-8 border-t-2 border-gray-200">
    <a href="/disease-detect">
      <button type="button"
        class="bg-gradient-to-r from-red-600 to-red-700 text-white px-10 py-4 rounded-full font-bold text-lg hover:from-red-700 hover:to-red-800 transition duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
        <span class="text-xl mr-2">ğŸ©º</span> Detect Crop Disease (Upload Leaf Image)
      </button>
    </a>
  </div>
  </div>
</section>

<!-- Footer -->
<footer class="bg-green-600 text-white text-center p-4 mt-10 text-sm sm:text-base">
  <p>Â© 2025 CropGenius | Designed for Smart Farming | à¤®à¤°à¤¾à¤ à¥€ à¤¸à¤®à¤°à¥à¤¥à¤¨ à¤²à¤µà¤•à¤°à¤š à¤¯à¥‡à¤¤ à¤†à¤¹à¥‡</p>
</footer>

<script type="text/javascript">
  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'en,mr',
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE
    }, 'google_translate_element');
  }

  // Weather API Integration
  async function fetchWeather() {
    const locationInput = document.getElementById('location');
    const location = locationInput.value.trim();
    const statusElement = document.getElementById('weather-status');

    if (!location) {
      statusElement.innerHTML = '<span class="text-red-600">âš ï¸ Please enter a location</span>';
      return;
    }

    // Show loading state
    statusElement.innerHTML = '<span class="text-blue-600">â³ Fetching weather data...</span>';
    
    try {
      const response = await fetch('/get-weather', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ location: location })
      });

      const data = await response.json();

      if (response.ok) {
        // Fill in the form fields with rounded values
        document.getElementById('temperature').value = parseFloat(data.temperature).toFixed(1);
        document.getElementById('humidity').value = Math.round(data.humidity);
        document.getElementById('rainfall').value = parseFloat(data.rainfall).toFixed(1);

        // Show success message
        statusElement.innerHTML = `<span class="text-green-600">âœ… Weather data loaded for ${data.location}</span>`;
        
        // Highlight the auto-filled fields
        highlightFields();
      } else {
        statusElement.innerHTML = `<span class="text-red-600">âŒ ${data.error}</span>`;
      }
    } catch (error) {
      statusElement.innerHTML = '<span class="text-red-600">âŒ Failed to fetch weather data. Please try again.</span>';
      console.error('Error:', error);
    }
  }

  // Highlight auto-filled fields temporarily
  function highlightFields() {
    const fields = ['temperature', 'humidity', 'rainfall'];
    fields.forEach(fieldId => {
      const field = document.getElementById(fieldId);
      field.classList.add('bg-green-100', 'border-green-400');
      setTimeout(() => {
        field.classList.remove('bg-green-100', 'border-green-400');
        field.classList.add('bg-yellow-50');
      }, 2000);
    });
  }

  // Allow Enter key to trigger weather fetch
  document.addEventListener('DOMContentLoaded', function() {
    const locationInput = document.getElementById('location');
    if (locationInput) {
      locationInput.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
          event.preventDefault();
          fetchWeather();
        }
      });
    }
  });
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

</body>
</html>
